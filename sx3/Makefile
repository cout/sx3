SRCDIR=src
DOCDIR=doc
DATADIR=data

SRC1= \
	main.c sx3_console.c sx3_engine.c sx3_graphics.c sx3_errors.c \
	sx3_global.c sx3_gui.c sx3_math.c sx3_misc.c \
	sx3_tanks.c sx3_terrain.c sx3_weapons.c sx3_state.c sx3_game.c \
	sx3_title.c sx3_audio.c
SRC=$(foreach file, $(SRC1), $(SRCDIR)/$(file))
OBJ=$(SRC:.c=.o)

# Check to see if we are running Windows
ifeq ($(COMSPEC),)
	# No COMSPEC, we must be on Unix
	CFLAGS= -g -O3 -Wall `imlib-config --cflags` `sdl-config --cflags`
	LDFLAGS=-L/usr/X11R6/lib -L/usr/local/lib -L../local/lib \
		`sdl-config --libs`
	LIBS= -lm -lGL -lGLU -lgfx -lSDL_image -lgltext -lphysics -lini
	INCLUDES=-I/usr/local/include -I/usr/X11R6/include -I../local/include
	OUT=sx3
else
	# Win32 mode -- home sick home
	CFLAGS=-g -O3 -Wall
	LDFLAGS=-L../local/lib
	LIBS=-lgfx -lphysics -lopengl32 -lglu32 -lm -lSDL -lSDL_image -lgltext \
        -lini
	INCLUDES=-I../local/include
	OUT=sx3.exe
endif
CC=gcc
CCC=CC

##### RULES #####

.SUFFIXES: .c .o .ln

# This means all .o files are generated by a .c file, by this rule.
.c.o: 
	$(CC) $(INCLUDES) $(CFLAGS) $(INCLUDES) -c $< -o $@

default: dep $(OUT)

include Makefile.d

$(OUT): $(OBJ)
	$(CC) $(CFLAGS) -o $(OUT) $(OBJ) $(LDFLAGS) $(LIBS)

dep:
	gcc -M $(CFLAGS) $(INCLUDES) $(SRC) > Makefile.d

clean:
	rm -f $(OBJ) $(OUT)
